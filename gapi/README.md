# gRPC

First of all, meet [the requirements](https://grpc.io/docs/languages/go/quickstart/).

## Concept

Remote Procedure Call(RPC) was originally developed by Google.

- Client can execute remote procedures on the server
- remote interaction code is handled by gRPC
- API & data structure is automatically generated by [Protocol Buffer Compiler](https://grpc.io/docs/protoc-installation/)(protoc)
- Supports many languages

## How It Works

1. Define API & Data structure.
2. Gen gRPC stubs
3. Implement the server
4. Use the client

## Why gRPC?

- High Performance Http/2: binary framing, multiplexing, header compression, bidirectional communication.
- Strong API Concept: server & client **share** the same highly typed RPC definition.
- Automatic Codegen: codes for Ser/De deta, transfer data between client server are automatically generated (need to write logic only).

There're 4 types gRPC at the communication perspective (unary & streaming on both server and client sides).

## Gateway

gRPC provides a way to use it with http request, that is, gRPC gateway.
It converts http request(s) to gRPC request(s) and binary response(s) to JSON response(s).
If there's only unary type of requests, In-process transformation applied but basically *Separate proxy server* needed.

## CLI client

https://github.com/ktr0731/evans.

1. Download release https://github.com/ktr0731/evans/releases
2. `tar xf path/to/evans_linux_..._.tar.gz`.
3. `mv path/to/extracted/evans /usr/local/bin`.

evans allows us to interact the rpc

```bash
$ evans --host localhost --port 9090 -r repl

  ______
 |  ____|
 | |__    __   __   __ _   _ __    ___
 |  __|   \ \ / /  / _. | | '_ \  / __|
 | |____   \ V /  | (_| | | | | | \__ \
 |______|   \_/    \__,_| |_| |_| |___/

 more expressive universal gRPC client


pb.SimpleBank@localhost:9090> show service
+------------+------------+-------------------+--------------------+
|  SERVICE   |    RPC     |   REQUEST TYPE    |   RESPONSE TYPE    |
+------------+------------+-------------------+--------------------+
| SimpleBank | CreateUser | CreateUserRequest | CreateUserResponse |
| SimpleBank | LoginUser  | LoginUserRequest  | LoginUserResponse  |
+------------+------------+-------------------+--------------------+

pb.SimpleBank@localhost:9090> call CreateUser
username (TYPE_STRING) => tg
full_name (TYPE_STRING) => xxxx
email (TYPE_STRING) => xxx@example.io
password (TYPE_STRING) => abc
command call: rpc error: code = Unimplemented desc = method CreateUser not implemented
```

## Implement gAPI

Stubs are created with `.proto` files and we need to implement actual logics.

To do that, [service file](../proto/service_simple_bank.proto) helps us.
We need to implement the interface

```go
// SimpleBankServer is the server API for SimpleBank service.
// All implementations must embed UnimplementedSimpleBankServer
// for forward compatibility
type SimpleBankServer interface {
	CreateUser(context.Context, *CreateUserRequest) (*CreateUserResponse, error)
	LoginUser(context.Context, *LoginUserRequest) (*LoginUserResponse, error)
	mustEmbedUnimplementedSimpleBankServer()
}
```

For example, [CreateUser](./rpc_create_user.go).
